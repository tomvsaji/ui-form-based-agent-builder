version: "3.9"

services:
  builder-backend:
    command: ["uvicorn", "app.builder_main:app", "--host", "0.0.0.0", "--port", "8000", "--reload"]
    volumes:
      - ./app:/app/app
      - ./config:/app/config

  runtime-api:
    command: ["uvicorn", "app.runtime_main:app", "--host", "0.0.0.0", "--port", "8001", "--reload"]
    volumes:
      - ./app:/app/app
      - ./config:/app/config

  builder-frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile.frontend.dev
    command: ["sh", "-c", "npm install && npm run dev -- -H 0.0.0.0 -p 3000"]
    environment:
      - NEXT_PUBLIC_API_BASE=/api
      - NEXT_PUBLIC_RUNTIME_BASE=/runtime
    volumes:
      - ./frontend:/app
      - frontend_node_modules:/app/node_modules

volumes:
  frontend_node_modules:
